<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSAT CRM - Dashboard</title>
    <link rel="stylesheet" href="../css/dashboard.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Select2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar" style="width: 250px; background-color: #f4f4f4; height: 100vh;">
            <div class="sidebar-header" style="padding: 20px; overflow: visible;">
                <div class="logo" style="display: flex; align-items: center; gap: 16px; max-width: 100%;">
                    <!-- Fully Visible Logo Image -->
                    <img src="../assets/logo1.png" alt="VSAT Logo"
                        style="height: 80px; width: 80px; object-fit: contain; border-radius: 8px; background-color: white; padding: 6px; box-shadow: 0 0 8px rgba(0,0,0,0.1); flex-shrink: 0;">

                    <div class="logo-text" style="line-height: 1.2; overflow: hidden;">
                        <h1 style="font-size: 20px; margin: 0; color: #0d47a1;">VSAT CRM</h1>
                        <p style="font-size: 13px; margin: 4px 0 0; color: #444;">Customer Dashboard</p>
                    </div>
                </div>
            </div>

            <!-- Updated Navigation Menu - Removed Product Management Section -->
            <nav class="sidebar-nav" style="padding: 0 20px;">
                <div class="nav-section">
                    <p class="nav-title" style="margin: 10px 0; font-weight: bold;">Main Menu</p>
                    <ul class="nav-list" style="list-style: none; padding: 0;">
                        <li>
                            <button class="nav-item active" data-section="overview">
                                <i class="fas fa-th-large"></i> Dashboard
                            </button>
                        </li>
                        <!-- Call Registration with Job History as submenu -->
                        <li class="has-submenu">
                            <button class="nav-item submenu-trigger">
                                <i class="fas fa-phone"></i> Call Registration
                                <i class="fas fa-chevron-down submenu-toggle" style="margin-left: auto;"></i>
                            </button>
                            <ul class="submenu" style="list-style: none; padding-left: 20px;">
                                <li>
                                    <button class="nav-item" data-section="complaint">
                                        <i class="fas fa-file-alt"></i> New Complaint/Job
                                    </button>
                                </li>
                                <li>
                                    <button class="nav-item" data-section="job-history">
                                        <i class="fas fa-history"></i> Job History
                                    </button>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <p class="nav-title" style="margin: 10px 0; font-weight: bold;">Settings</p>
                    <ul class="nav-list" style="list-style: none; padding: 0;">
                        <li>
                            <button class="nav-item" data-section="preferences">
                                <i class="fas fa-cog"></i> Preferences
                            </button>
                        </li>
                        <li>
                            <button class="nav-item" data-section="user-management">
                                <i class="fas fa-users"></i> User Management
                            </button>
                        </li>
                    </ul>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h2>Customer Service Portal</h2>
                </div>
                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search customers, jobs...">
                    </div>
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-info">
                            <p class="user-name">VSAT</p>
                            <p class="user-role">Support Agent</p>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="content">
                <!-- Dashboard Overview -->
                <div id="overview" class="section active">
                    <div class="section-header">
                        <h3>Dashboard Overview</h3>
                        <p>Welcome back! Here's what's happening with your service requests.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-text">
                                    <p class="stat-label">Total Customers</p>
                                    <p class="stat-value">156</p>
                                </div>
                                <div class="stat-icon blue">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-text">
                                    <p class="stat-label">Active Jobs</p>
                                    <p class="stat-value">8</p>
                                </div>
                                <div class="stat-icon orange">
                                    <i class="fas fa-wrench"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-text">
                                    <p class="stat-label">Completed Jobs</p>
                                    <p class="stat-value">156</p>
                                </div>
                                <div class="stat-icon green">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-content">
                                <div class="stat-text">
                                    <p class="stat-label">Pending Jobs</p>
                                    <p class="stat-value">3</p>
                                </div>
                                <div class="stat-icon yellow">
                                    <i class="fas fa-clock"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h4>Recent Activity</h4>
                            </div>
                            <div class="card-content">
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-dot green"></div>
                                        <div class="activity-content">
                                            <p class="activity-title">Job #1003 completed</p>
                                            <p class="activity-subtitle">Customer: John Doe - Service completed</p>
                                        </div>
                                        <span class="activity-time">2 min ago</span>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-dot blue"></div>
                                        <div class="activity-content">
                                            <p class="activity-title">New complaint registered</p>
                                            <p class="activity-subtitle">Customer: Jane Smith - Installation request</p>
                                        </div>
                                        <span class="activity-time">15 min ago</span>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-dot orange"></div>
                                        <div class="activity-content">
                                            <p class="activity-title">Job #1002 in progress</p>
                                            <p class="activity-subtitle">Customer: Mike Wilson - Repair work</p>
                                        </div>
                                        <span class="activity-time">1 hour ago</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Updated Quick Actions - Removed Product Management -->
                        <div class="card">
                            <div class="card-header">
                                <h4>Quick Actions</h4>
                            </div>
                            <div class="card-content">
                                <div class="quick-actions">
                                    <button class="quick-action-btn" data-action="register-complaint">
                                        <i class="fas fa-phone"></i>
                                        <p>Register Complaint</p>
                                    </button>
                                    <button class="quick-action-btn" data-action="view-jobs">
                                        <i class="fas fa-history"></i>
                                        <p>View Job History</p>
                                    </button>
                                    <button class="quick-action-btn" data-action="view-reports">
                                        <i class="fas fa-chart-bar"></i>
                                        <p>View Reports</p>
                                    </button>
                                    <button class="quick-action-btn" data-action="view-reports">
                                        <i class="fas fa-cog"></i>
                                        <p>Settings</p>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Complaint/Job Sheet Section with Product Storage -->
                <div id="complaint" class="section">
                    <div class="section-header">
                        <h3>New Complaint / Job Registration</h3>
                        <p>Register a new service request and automatically save product details</p>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h4><i class="fas fa-phone"></i> Complaint / Job Sheet</h4>
                        </div>
                        <div class="card-content">
                            <form id="callForm">
                                <!-- Call Type -->
                                <div class="form-section">
                                    <label class="section-label">Call Type*</label>
                                    <div class="radio-group">
                                        <label class="radio-label">
                                            <input type="radio" name="callType" value="Installation" />
                                            <span>Installation</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="callType" value="Reinstallation" />
                                            <span>Reinstallation</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="callType" value="Demo" />
                                            <span>Demo</span>
                                        </label>
                                        <label class="radio-label">
                                            <input type="radio" name="callType" value="Repairs" />
                                            <span>Repairs</span>
                                        </label>
                                    </div>
                                    <div id="callTypeError" class="error-message"></div>
                                </div>

                                <!-- Customer Information Section -->
                                <div class="form-section">
                                    <h5 style="color: #1e293b; margin-bottom: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;">
                                        <i class="fas fa-user"></i> Customer Information
                                    </h5>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="fullName">Full Name*</label>
                                            <input type="text" id="fullName" placeholder="Enter full name" required />
                                            <div id="fullNameError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="mobile">Mobile Number*</label>
                                            <input type="text" id="mobile" placeholder="10-digit number" required />
                                            <div id="mobileError" class="error-message"></div>
                                        </div>
                                    </div>

                                    <!-- Address Information -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="houseNo">House/Flat No*</label>
                                            <input type="text" id="houseNo" placeholder="Enter house/flat number" required />
                                            <div id="houseNoError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="street">Street, Area, Sector*</label>
                                            <input type="text" id="street" placeholder="Enter street name" required />
                                            <div id="streetError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="landmark">Landmark</label>
                                            <input type="text" id="landmark" placeholder="E.g., near apollo hospital" />
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="pin">Pin Code*</label>
                                            <input type="text" id="pin" placeholder="6-digit pincode" required />
                                            <div id="pinError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="locality">Locality*</label>
                                            <select id="locality" required>
                                                <option value="">-- Select locality --</option>
                                            </select>
                                            <div id="localityError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="city">City*</label>
                                            <input type="text" id="city" placeholder="City" readonly />
                                            <div id="cityError" class="error-message"></div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="stateSelect">State*</label>
                                            <select id="stateSelect" required>
                                                <option value="">-- Select State --</option>
                                                <option value="01">JAMMU AND KASHMIR</option>
                                                <option value="02">HIMACHAL PRADESH</option>
                                                <option value="03">PUNJAB</option>
                                                <option value="04">CHANDIGARH</option>
                                                <option value="05">UTTARAKHAND</option>
                                                <option value="06">HARYANA</option>
                                                <option value="07">DELHI</option>
                                                <option value="08">RAJASTHAN</option>
                                                <option value="09">UTTAR PRADESH</option>
                                                <option value="10">BIHAR</option>
                                                <option value="11">SIKKIM</option>
                                                <option value="12">ARUNACHAL PRADESH</option>
                                                <option value="13">NAGALAND</option>
                                                <option value="14">MANIPUR</option>
                                                <option value="15">MIZORAM</option>
                                                <option value="16">TRIPURA</option>
                                                <option value="17">MEGHALAYA</option>
                                                <option value="18">ASSAM</option>
                                                <option value="19">WEST BENGAL</option>
                                                <option value="20">JHARKHAND</option>
                                                <option value="21">ODISHA</option>
                                                <option value="22">CHATTISGARH</option>
                                                <option value="23">MADHYA PRADESH</option>
                                                <option value="24">GUJARAT</option>
                                                <option value="26">DADRA AND NAGAR HAVELI AND DAMAN AND DIU</option>
                                                <option value="27">MAHARASHTRA</option>
                                                <option value="28">ANDHRA PRADESH</option>
                                                <option value="29">KARNATAKA</option>
                                                <option value="30">GOA</option>
                                                <option value="31">LAKSHADWEEP</option>
                                                <option value="32">KERELA</option>
                                                <option value="33">TAMIL NADU</option>
                                                <option value="34">PUDUCHERRY</option>
                                                <option value="35">ANDAMAN AND NICOBAR ISLANDS</option>
                                                <option value="36">TELANGANA</option>
                                                <option value="37">ANDHRA PRADESH</option>
                                                <option value="38">LADAKH</option>
                                                <option value="97">OTHER TERRITORY</option>
                                                <option value="99">CENTRE JURISDICTION</option>
                                            </select>
                                            <div id="stateSelectError" class="error-message"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Product Information Section -->
                                <div class="form-section">
                                    <h5 style="color: #1e293b; margin-bottom: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;">
                                        <i class="fas fa-box"></i> Product Information
                                        <small style="color: #64748b; font-weight: normal;">(This product will be automatically saved to your account)</small>
                                    </h5>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="productType">Product Type*</label>
                                            <input type="text" id="productType" placeholder="E.g., TV, Washing Machine, AC" required />
                                            <div id="productTypeError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="productName">Product Name*</label>
                                            <input type="text" id="productName" placeholder="E.g., Samsung Smart TV 55 inch" required/>
                                            <div id="productNameError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="modelNo">Model No.*</label>
                                            <input type="text" id="modelNo" placeholder="Enter model number" required />
                                            <div id="modelNoError" class="error-message"></div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="serial">Serial Number*</label>
                                            <input type="text" id="serial" placeholder="E.g., AB123456789"/>
                                            <div id="serialError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="manufacturer">Manufacturer*</label>
                                            <input type="text" id="manufacturer" placeholder="E.g., Samsung, LG, Apple" required/>
                                            <div id="manufacturerError" class="error-message"></div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="purchaseDate">Date of Purchase*</label>
                                            <input type="date" id="purchaseDate" required />
                                            <div id="purchaseDateError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="warrantyExpiry">Warranty Expiry*</label>
                                            <input type="date" id="warrantyExpiry" required />
                                            <div id="warrantyExpiryError" class="error-message"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Service Information Section -->
                                <div class="form-section">
                                    <h5 style="color: #1e293b; margin-bottom: 16px; border-bottom: 2px solid #e2e8f0; padding-bottom: 8px;">
                                        <i class="fas fa-calendar"></i> Service Information
                                    </h5>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="availableDate">Customer Available Date*</label>
                                            <input type="date" id="availableDate" required />
                                            <div id="availableDateError" class="error-message"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="preferredTime">Preferred Time Slot*</label>
                                            <select id="preferredTime" required>
                                                <option value="">-- Select time slot --</option>
                                                <option value="10am-1pm">10 AM – 1 PM</option>
                                                <option value="2pm-4pm">2 PM – 4 PM</option>
                                                <option value="4pm-7pm">4 PM – 7 PM</option>
                                            </select>
                                            <div id="preferredTimeError" class="error-message"></div>
                                        </div>
                                    </div>

                                    <!-- Optional Comments -->
                                    <div class="form-group">
                                        <label for="comments">Additional Comments</label>
                                        <textarea id="comments" rows="3" placeholder="Any additional information or special instructions..."></textarea>
                                    </div>

                                    <!-- Call Priority -->
                                    <div class="form-section">
                                        <label class="section-label">Call Priority*</label>
                                        <div class="radio-group">
                                            <label class="radio-label">
                                                <input type="radio" name="priority" value="Normal" />
                                                <span>Normal</span>
                                            </label>
                                            <label class="radio-label urgent">
                                                <input type="radio" name="priority" value="Urgent" />
                                                <span>Urgent</span>
                                            </label>
                                        </div>
                                        <div id="priorityError" class="error-message"></div>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-phone"></i> Register Call & Save Product
                                    </button>
                                    <button type="button" class="btn btn-outline" id="resetBtn">
                                        <i class="fas fa-undo"></i> Reset Form
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Job History Section -->
                <div id="job-history" class="section">
                    <div class="section-header">
                        <div>
                            <h3>Job History</h3>
                            <p>Search and track all service requests by customer details</p>
                        </div>
                        <button class="btn btn-primary" id="createNewJobBtn">Create New Job</button>
                    </div>

                    <!-- Customer Search Card -->
                    <div class="card" style="margin-bottom: 24px;">
                        <div class="card-header">
                            <h4><i class="fas fa-search"></i> Search Customer Jobs</h4>
                        </div>
                        <div class="card-content">
                            <form id="customerSearchForm">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="searchCustomerName">Customer Name*</label>
                                        <input type="text" id="searchCustomerName" placeholder="Enter customer full name" required />
                                        <div id="searchCustomerNameError" class="error-message"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="searchMobile">Mobile Number*</label>
                                        <input type="text" id="searchMobile" placeholder="10-digit mobile number" required />
                                        <div id="searchMobileError" class="error-message"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="searchPincode">Pin Code*</label>
                                        <input type="text" id="searchPincode" placeholder="6-digit pincode" required />
                                        <div id="searchPincodeError" class="error-message"></div>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-search"></i> Search Jobs
                                    </button>
                                    <button type="button" class="btn btn-outline" id="clearSearchBtn">
                                        <i class="fas fa-times"></i> Clear Search
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Jobs Results Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="table-header">
                                <h4>Service Jobs</h4>
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="jobTableSearch" placeholder="Search in results...">
                                </div>
                            </div>
                        </div>
                        <div class="card-content">
                            <!-- Loading indicator -->
                            <div id="loadingIndicator" style="display: none; text-align: center; padding: 20px;">
                                <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #2563eb;"></i>
                                <p style="margin-top: 10px; color: #64748b;">Searching for customer jobs...</p>
                            </div>
                            
                            <!-- No results message -->
                            <div id="noResultsMessage" style="display: none; text-align: center; padding: 40px;">
                                <i class="fas fa-search" style="font-size: 48px; color: #cbd5e1; margin-bottom: 16px;"></i>
                                <h4 style="color: #64748b; margin-bottom: 8px;">No Jobs Found</h4>
                                <p style="color: #9ca3af;">Enter customer details above to search for their service history.</p>
                            </div>

                            <!-- Jobs table -->
                            <div class="table-container" id="jobsTableContainer">
                                <table class="jobs-table" id="jobsTable">
                                    <thead>
                                        <tr>
                                            <th>Job ID</th>
                                            <th>Customer Details</th>
                                            <th>Service Type</th>
                                            <th>Status</th>
                                            <th>Priority</th>
                                            <th>Technician</th>
                                            <th>Created Date</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="jobsTableBody">
                                        <!-- Dynamic content will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Sections (Placeholder) -->
                <div id="preferences" class="section">
                    <div class="section-header">
                        <h3>Preferences</h3>
                        <p>Manage your application preferences and settings</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p style="text-align: center; color: #64748b; padding: 40px;">
                                <i class="fas fa-cog" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                                Preferences settings will be implemented here.
                            </p>
                        </div>
                    </div>
                </div>

                <div id="user-management" class="section">
                    <div class="section-header">
                        <h3>User Management</h3>
                        <p>Manage user accounts and permissions</p>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <p style="text-align: center; color: #64748b; padding: 40px;">
                                <i class="fas fa-users" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>
                                User management features will be implemented here.
                            </p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="../js/Config.js"></script>
    <script src="../js/dashboard.js"></script>
</body>
<style>
    * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #f8fafc;
    color: #1e293b;
    line-height: 1.6;
}

.has-submenu.active .submenu {
    display: block;
}

.has-submenu .submenu-toggle {
    transition: transform 0.3s ease;
}

.has-submenu.active .submenu-toggle {
    transform: rotate(180deg);
}

/* Nav item styles */
.nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    width: 100%;
    background: none;
    border: none;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s;
}

.nav-item:hover {
    background-color: #e0e0e0;
}

.nav-item.active {
    background-color: #0d47a1;
    color: white;
}

.nav-item.active i {
    color: #0d47a1;
}

.dashboard {
    display: flex;
    height: 100vh;
}

/* Custom Scrollbar Styles */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 4px;
    transition: background-color 0.2s;
}

::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
}

::-webkit-scrollbar-corner {
    background: #f1f5f9;
}

/* Firefox scrollbar */
* {
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 #f1f5f9;
}

/* Sidebar Styles */
.sidebar {
    width: 256px;
    background: white;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

.sidebar-header {
    padding: 24px;
    border-bottom: 1px solid #e2e8f0;
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo i {
    font-size: 32px;
    color: #2563eb;
}

.logo-text h1 {
    font-size: 20px;
    font-weight: 700;
    color: #1e293b;
}

.logo-text p {
    font-size: 14px;
    color: #64748b;
}

.sidebar-nav {
    padding: 24px 0;
    flex: 1;
    overflow-y: auto;
}

.nav-section {
    margin-bottom: 32px;
    padding: 0 12px;
}

.nav-title {
    font-size: 12px;
    font-weight: 600;
    color: #9ca3af;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
    padding: 0 12px;
}

.nav-list {
    list-style: none;
}

.nav-item {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    font-size: 14px;
    font-weight: 500;
    color: #64748b;
    background: none;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 4px;
}

.nav-item:hover {
    background-color: #f1f5f9;
    color: #1e293b;
}

.nav-item.active {
    background-color: #eff6ff;
    color: #1d4ed8;
    border-right: 2px solid #1d4ed8;
}

.nav-item i {
    width: 20px;
    font-size: 16px;
}

/* Main Content */
.main-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* Header */
.header {
    background: white;
    padding: 16px 24px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}

.header-left h2 {
    font-size: 24px;
    font-weight: 600;
    color: #1e293b;
}

.header-right {
    display: flex;
    align-items: center;
    gap: 16px;
}

.search-box {
    position: relative;
    display: flex;
    align-items: center;
}

.search-box i {
    position: absolute;
    left: 12px;
    color: #9ca3af;
    font-size: 14px;
}

.search-box input {
    padding: 8px 12px 8px 36px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    width: 320px;
    outline: none;
    transition: border-color 0.2s;
}

.search-box input:focus {
    border-color: #2563eb;
}

.notification-btn {
    padding: 8px;
    background: none;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    color: #64748b;
    transition: background-color 0.2s;
}

.notification-btn:hover {
    background-color: #f1f5f9;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-avatar {
    width: 32px;
    height: 32px;
    background-color: #2563eb;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
}

.user-info {
    font-size: 14px;
}

.user-name {
    font-weight: 500;
    color: #1e293b;
}

.user-role {
    color: #64748b;
}

/* Content Area */
.content {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
    max-height: calc(100vh - 80px);
}

.section {
    display: none;
}

.section.active {
    display: block;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
}

.section-header h3 {
    font-size: 28px;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 4px;
}

.section-header p {
    color: #64748b;
    font-size: 16px;
}

/* Cards */
.card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.card-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e2e8f0;
}

.card-header h4 {
    font-size: 18px;
    font-weight: 600;
    color: #1e293b;
    display: flex;
    align-items: center;
    gap: 8px;
}

.card-content {
    padding: 24px;
    max-height: 470px;
    overflow-y: auto;
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.stat-content {
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.stat-label {
    font-size: 14px;
    font-weight: 500;
    color: #64748b;
    margin-bottom: 4px;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: #1e293b;
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.stat-icon.blue {
    background-color: #eff6ff;
    color: #2563eb;
}

.stat-icon.orange {
    background-color: #fff7ed;
    color: #ea580c;
}

.stat-icon.green {
    background-color: #f0fdf4;
    color: #16a34a;
}

.stat-icon.yellow {
    background-color: #fefce8;
    color: #ca8a04;
}

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 24px;
}

/* Activity List */
.activity-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-height: 300px;
    overflow-y: auto;
    padding-right: 8px;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 12px;
}

.activity-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

.activity-dot.green {
    background-color: #16a34a;
}

.activity-dot.blue {
    background-color: #2563eb;
}

.activity-dot.orange {
    background-color: #ea580c;
}

.activity-content {
    flex: 1;
}

.activity-title {
    font-size: 14px;
    font-weight: 500;
    color: #1e293b;
    margin-bottom: 2px;
}

.activity-subtitle {
    font-size: 12px;
    color: #64748b;
}

.activity-time {
    font-size: 12px;
    color: #9ca3af;
}

/* Quick Actions */
.quick-actions {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
}

.quick-action-btn {
    padding: 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    transition: background-color 0.2s;
    text-align: center;
}

.quick-action-btn:hover {
    background-color: #f8fafc;
}

.quick-action-btn i {
    font-size: 32px;
    margin-bottom: 8px;
    display: block;
}

.quick-action-btn:nth-child(1) i {
    color: #2563eb;
}

.quick-action-btn:nth-child(2) i {
    color: #16a34a;
}

.quick-action-btn:nth-child(3) i {
    color: #7c3aed;
}

.quick-action-btn:nth-child(4) i {
    color: #ea580c;
}

.quick-action-btn p {
    font-size: 14px;
    font-weight: 500;
    color: #1e293b;
}

/* Badges */
.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.badge-success {
    background-color: #dcfce7;
    color: #166534;
}

.badge-warning {
    background-color: #fef3c7;
    color: #92400e;
}

.badge-primary {
    background-color: #dbeafe;
    color: #1e40af;
}

.badge-danger {
    background-color: #fee2e2;
    color: #dc2626;
}

/* Buttons */
.btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.btn-primary {
    background-color: #2563eb;
    color: white;
}

.btn-primary:hover {
    background-color: #1d4ed8;
}

.btn-outline {
    background-color: transparent;
    color: #64748b;
    border: 1px solid #d1d5db;
}

.btn-outline:hover {
    background-color: #f8fafc;
    color: #1e293b;
}

/* Form Styles */
.form-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 16px;
    margin-bottom: 16px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.form-group label {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
}

.form-group input,
.form-group select,
.form-group textarea {
    padding: 8px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    border-color: #2563eb;
}

.form-group textarea {
    resize: vertical;
    min-height: 80px;
}

.form-actions {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

/* Form Section Styles for Radio Groups */
.form-section {
    margin-bottom: 20px;
}

.section-label {
    font-size: 14px;
    font-weight: 500;
    color: #374151;
    margin-bottom: 8px;
    display: block;
}

.radio-group {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    font-size: 14px;
    color: #374151;
}

.radio-label input[type="radio"] {
    margin: 0;
}

/* Table Styles */
.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.table-container {
    overflow-x: auto;
    max-height: 500px;
    overflow-y: auto;
}

.jobs-table {
    width: 100%;
    border-collapse: collapse;
}

.jobs-table th {
    text-align: left;
    padding: 12px 16px;
    font-weight: 500;
    color: #64748b;
    border-bottom: 1px solid #e2e8f0;
    font-size: 14px;
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
}

.jobs-table td {
    padding: 16px;
    border-bottom: 1px solid #e2e8f0;
    font-size: 14px;
}

.jobs-table tr:hover {
    background-color: #f8fafc;
}

.job-id {
    font-family: 'Courier New', monospace;
    font-weight: 500;
    font-size: 14px;
}

.product-cell .product-name {
    font-weight: 500;
    color: #1e293b;
    margin-bottom: 2px;
}

.product-cell .serial-number {
    font-size: 12px;
    color: #64748b;
    font-family: 'Courier New', monospace;
}

.date-cell {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 14px;
    color: #64748b;
}

.action-buttons {
    display: flex;
    gap: 4px;
}

.action-btn {
    padding: 6px;
    background: none;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: #64748b;
    transition: background-color 0.2s;
}

.action-btn:hover {
    background-color: #f1f5f9;
}

/* Make the text red for the urgent label */
.radio-label.urgent span {
  color: red;
}

/* Make the radio button itself red (modern browsers) */
.radio-label.urgent input[type="radio"] {
  accent-color: red;
}

/* Optional: Change label text to red on hover */
.radio-label.urgent:hover span {
  color: darkred;
}

/* Error Message Styling */
.error-message {
  color: #dc2626; /* Red color */
  font-size: 13px;
  margin-top: 3px;
  margin-left: 2px;
  animation: shake 0.3s ease;
}

/* Error highlight for invalid inputs */
.input-error {
  border-color: #dc2626 !important;
  box-shadow: 0 0 6px rgba(220, 38, 38, 0.5);
}

/* Valid input styling */
.input-valid {
  border-color: #16a34a !important;
  background-color: #f0fdf4;
}

/* Shake animation for error indication */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  50% { transform: translateX(5px); }
  75% { transform: translateX(-5px); }
  100% { transform: translateX(0); }
}

/* Responsive Design */
@media (max-width: 1024px) {
    .dashboard {
        flex-direction: column;
    }
    
    .sidebar {
        width: 100%;
        height: auto;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .header-right {
        flex-direction: column;
        gap: 8px;
    }
    
    .search-box input {
        width: 200px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .section-header {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
    }
    
    .radio-group {
        flex-direction: column;
        gap: 8px;
    }
}
/* Toast container positioned relative to header - Keep your existing */
.toast-container {
  position: fixed;
  top: 70px; /* just below header */
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  pointer-events: none;
  width: 320px;
  max-width: 90vw;
}

/* Base toast style - Enhanced with emoji support */
.custom-toast {
  position: relative;
  background-color: #2ecc71; /* default success green */
  color: white;
  padding: 14px 24px 14px 50px; /* Extra left padding for emoji */
  margin: 8px 0;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(46, 204, 113, 0.5);
  font-weight: 600;
  font-size: 1rem;
  opacity: 0;
  transform: translateY(-30px);
  pointer-events: auto;
  transition: opacity 0.3s ease, transform 0.3s ease;
  user-select: none;
  text-align: left;
  will-change: opacity, transform;
  min-height: 50px;
}

/* Emoji positioning */
.custom-toast::before {
  content: "✅"; /* Default success emoji */
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1.3em;
}

/* Show toast - Keep your existing */
.custom-toast.visible {
  opacity: 1;
  transform: translateY(0);
}

/* Error toast - Enhanced */
.custom-toast.error {
  background-color: #e74c3c;
  box-shadow: 0 4px 15px rgba(231, 76, 60, 0.5);
}
.custom-toast.error::before {
  content: "❌";
}

/* Success toast - Enhanced */
.custom-toast.success {
  background-color: #2ecc71;
  box-shadow: 0 4px 15px rgba(46, 204, 113, 0.5);
}
/* .custom-toast.success::before {
  content: "✅";
} */

/* Warning toast - New */
.custom-toast.warning {
  background-color: #f39c12;
  box-shadow: 0 4px 15px rgba(243, 156, 18, 0.5);
  color: #1a1a1a;
}
.custom-toast.warning::before {
  content: "⚠️";
}

/* Multi-line message support */
.toast-message {
  display: block;
  white-space: pre-line; /* Respects \n line breaks */
}

/* Close button - Optional */
.toast-close {
  position: absolute;
  right: 12px;
  top: 12px;
  background: transparent;
  border: none;
  color: inherit;
  opacity: 0.7;
  cursor: pointer;
  font-size: 1.1em;
  line-height: 1;
  padding: 0;
}
.toast-close:hover {
  opacity: 1;
}
/* Your existing styles - preserved exactly */
.has-submenu .submenu {
    display: none;
    transition: all 0.3s ease;
    overflow: hidden;
}

.toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
}

.custom-toast {
    padding: 12px 20px 12px 45px; /* Added left padding for emoji */
    margin-bottom: 10px;
    border-radius: 4px;
    color: white;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
    position: relative;
    min-height: 44px;
    display: flex;
    align-items: center;
}

.custom-toast.visible {
    opacity: 1;
    transform: translateX(0);
}

.custom-toast.success {
    background-color: #4CAF50;
}

.custom-toast.error {
    background-color: #F44336;
}

/* New additions that won't conflict with your existing styles */
.custom-toast::before {
    content: "";
    position: absolute;
    left: 15px;
    font-size: 1.2em;
}

.custom-toast.success::before {
    content: "✅";
}

.custom-toast.error::before {
    content: "❌";
}

/* New warning style */
.custom-toast.warning {
    background-color: #FF9800;
    color: #1a1a1a;
}

.custom-toast.warning::before {
    content: "⚠️";
}

/* Message formatting */
.toast-message {
    white-space: pre-line;
    line-height: 1.4;
}

/* Close button - optional */
.toast-close {
    position: absolute;
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    color: inherit;
    opacity: 0.7;
    cursor: pointer;
    font-size: 16px;
    line-height: 1;
    padding: 4px;
}

.toast-close:hover {
    opacity: 1;
}
</style>
<script>
    
document.addEventListener("DOMContentLoaded", function () {
  // Initialize all functionality
  initDashboard();
  initForms();
  initToast();
  initUI();
  initJobSearch();
});

function initDashboard() {
  const navItems = document.querySelectorAll(".nav-item");
  const submenuTriggers = document.querySelectorAll(".submenu-trigger");
  const quickActionBtns = document.querySelectorAll(".quick-action-btn");
  const searchInputs = document.querySelectorAll(".search-box input");

  // Section navigation
  function showSection(sectionId) {
    document.querySelectorAll(".section").forEach((section) => {
      section.classList.toggle("active", section.id === sectionId);
    });

    navItems.forEach((item) => {
      item.classList.toggle("active", item.dataset.section === sectionId);
    });
  }

  navItems.forEach((item) => {
    item.addEventListener("click", function () {
      const sectionId = this.dataset.section;
      if (sectionId) showSection(sectionId);
    });
  });

  // Submenu handling
  submenuTriggers.forEach((trigger) => {
    trigger.addEventListener("click", function (e) {
      if (e.target.classList.contains("submenu-toggle")) {
        const parentLi = this.closest(".has-submenu");
        parentLi.classList.toggle("active");

        document.querySelectorAll(".has-submenu").forEach((item) => {
          if (item !== parentLi) item.classList.remove("active");
        });

        const icon = this.querySelector(".submenu-toggle");
        icon.classList.toggle("fa-chevron-up");
        icon.classList.toggle("fa-chevron-down");
        e.stopPropagation();
      }
    });
  });

  document.addEventListener("click", () => {
    document.querySelectorAll(".has-submenu").forEach((item) => {
      item.classList.remove("active");
    });
  });

  // Updated Quick actions - removed product-related actions
  quickActionBtns.forEach((btn) => {
    btn.addEventListener("click", function () {
      const action = this.dataset.action;
      const actions = {
        "register-complaint": () => showSection("complaint"),
        "view-jobs": () => showSection("job-history"),
        "view-reports": () =>
          showToast("View Reports functionality would be implemented here", "success"),
      };
      if (actions[action]) actions[action]();
    });
  });

  // Search functionality
  searchInputs.forEach((input) => {
    input.addEventListener("input", function () {
      const searchTerm = this.value.toLowerCase();
      if (this.id === "jobTableSearch") {
        filterJobsTable(searchTerm);
      }
    });
  });

  // Initial setup
  showSection("overview");
  animateStats();
}

// Initialize job search functionality
function initJobSearch() {
  const customerSearchForm = document.getElementById("customerSearchForm");
  const clearSearchBtn = document.getElementById("clearSearchBtn");
  const createNewJobBtn = document.getElementById("createNewJobBtn");

  if (!customerSearchForm) return;

  // Customer search form validation and submission
  customerSearchForm.addEventListener("submit", async function (e) {
    e.preventDefault();

    const customerName = document.getElementById("searchCustomerName").value.trim();
    const mobile = document.getElementById("searchMobile").value.trim();
    const pincode = document.getElementById("searchPincode").value.trim();

    // Validate search fields
    let isValid = true;

    if (!customerName) {
      document.getElementById("searchCustomerNameError").textContent = "Customer name is required";
      isValid = false;
    } else {
      document.getElementById("searchCustomerNameError").textContent = "";
    }

    if (!mobile || !/^\d{10}$/.test(mobile)) {
      document.getElementById("searchMobileError").textContent = "Enter a valid 10-digit mobile number";
      isValid = false;
    } else {
      document.getElementById("searchMobileError").textContent = "";
    }

    if (!pincode || !/^\d{6}$/.test(pincode)) {
      document.getElementById("searchPincodeError").textContent = "Enter a valid 6-digit pincode";
      isValid = false;
    } else {
      document.getElementById("searchPincodeError").textContent = "";
    }

    if (!isValid) {
      showToast("Please fill all search fields correctly", "error");
      return;
    }

    // Show loading indicator
    showLoadingIndicator(true);
    hideNoResultsMessage();
    hideJobsTable();

    try {
      console.log("The job fuction is calling the api")
      const jobs = await searchCustomerJobs(customerName, mobile, pincode);

      if (jobs && jobs.length > 0) {
        displayJobsInTable(jobs);
        showToast(`Found ${jobs.length} job(s) for the customer`, "success");
      } else {
        showNoResultsMessage();
        showToast("No jobs found for the specified customer details", "error");
      }
    } catch (error) {
      console.error("Error searching customer jobs:", error);
      showToast("Error searching for customer jobs. Please try again.", "error");
      showNoResultsMessage();
    } finally {
      showLoadingIndicator(false);
    }
  });

  // Clear search functionality
  clearSearchBtn.addEventListener("click", function () {
    customerSearchForm.reset();
    document.querySelectorAll(".error-message").forEach(error => error.textContent = "");
    hideJobsTable();
    showNoResultsMessage();
    showToast("Search cleared", "success");
  });

  // Create new job button
  createNewJobBtn.addEventListener("click", function () {
    showSection("complaint");
    showToast("Redirected to complaint registration", "success");
  });

  // Initialize with no results message
  showNoResultsMessage();
}

// Function to search customer jobs via API
async function searchCustomerJobs(customerName, mobile, pincode) {
  const token = getCookie("token");

  if (!token) {
    throw new Error("Authentication token not found");
  }
  console.log("Token" + token)
  const searchParams = {
    customerName: customerName,
    mobile: mobile,
    pincode: pincode
  };

  try {
    const response = await fetch(`${API_URL}/job/fetchcustomerJobs`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify(searchParams)
    });

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || "Failed to search customer jobs");
    }

    const data = await response.json();
    console.log(data.jobs);
    return data.jobs || [];
  } catch (error) {
    console.error("API Error:", error);
    throw error;
  }
}

// Function to display jobs in the table
function displayJobsInTable(jobs) {
  const tableBody = document.getElementById("jobsTableBody");
  const tableContainer = document.getElementById("jobsTableContainer");

  if (!tableBody) return;

  // Clear existing rows
  tableBody.innerHTML = "";

  jobs.forEach((job, index) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td><span class="job-id">#${job.job_id}</span></td>
      <td>
        <div class="product-cell">
          <p class="product-name">${job.full_name || 'N/A'}</p>
          <p class="serial-number">Mobile: ${job.mobile_number || 'N/A'}</p>
          <p class="serial-number">Pin: ${job.pin_code || 'N/A'}</p>
        </div>
      </td>
      <td>${job.call_type || job.serviceType || 'N/A'}</td>
      <td><span class="badge ${getStatusBadgeClass(job.status)}">${job.status || 'Pending'}</span></td>
      <td><span class="badge ${getPriorityBadgeClass(job.priority)}">${job.priority || 'Normal'}</span></td>
      <td>${job.technician || 'Not Assigned'}</td>
      <td>
        <div class="date-cell">
          <i class="fas fa-calendar"></i>
          ${formatDate(job.created_at)}
        </div>
      </td>
      <td>
        <div class="action-buttons">
          <button class="action-btn" onclick="viewJobDetails('${job.jobId || job._id}')">
            <i class="fas fa-eye"></i>
          </button>
          <button class="action-btn" onclick="editJob('${job.jobId || job._id}')">
            <i class="fas fa-edit"></i>
          </button>
        </div>
      </td>
    `;
    tableBody.appendChild(row);
  });

  // Show the table
  tableContainer.style.display = "block";
}

// Helper functions for job display
function getStatusBadgeClass(status) {
  const statusClasses = {
    'completed': 'badge-success',
    'in progress': 'badge-primary',
    'pending': 'badge-warning',
    'cancelled': 'badge-danger'
  };
  return statusClasses[status?.toLowerCase()] || 'badge-warning';
}

function getPriorityBadgeClass(priority) {
  const priorityClasses = {
    'urgent': 'badge-danger',
    'high': 'badge-danger',
    'medium': 'badge-warning',
    'normal': 'badge-success',
    'low': 'badge-success'
  };
  return priorityClasses[priority?.toLowerCase()] || 'badge-success';
}

function formatDate(dateString) {
  if (!dateString) return 'N/A';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-IN');
}

// UI helper functions for job search
function showLoadingIndicator(show) {
  const indicator = document.getElementById("loadingIndicator");
  if (indicator) {
    indicator.style.display = show ? "block" : "none";
  }
}

function showNoResultsMessage() {
  const message = document.getElementById("noResultsMessage");
  if (message) {
    message.style.display = "block";
  }
}

function hideNoResultsMessage() {
  const message = document.getElementById("noResultsMessage");
  if (message) {
    message.style.display = "none";
  }
}

function hideJobsTable() {
  const tableContainer = document.getElementById("jobsTableContainer");
  if (tableContainer) {
    tableContainer.style.display = "none";
  }
}

// Job action functions
function viewJobDetails(jobId) {
  showToast(`Viewing details for job ${jobId}`, "success");
  // Implement job details view functionality
}

function editJob(jobId) {
  showToast(`Editing job ${jobId}`, "success");
  // Implement job editing functionality
}

// Filter jobs table based on search term
function filterJobsTable(searchTerm) {
  const tableRows = document.querySelectorAll("#jobsTableBody tr");
  tableRows.forEach(row => {
    const text = row.textContent.toLowerCase();
    row.style.display = text.includes(searchTerm) ? "" : "none";
  });
}

// Enhanced form initialization with product storage functionality
function initForms() {
  const callForm = document.getElementById("callForm");
  if (!callForm) return;

  // Field validation functions
  function validateField(id, condition, errorMessage) {
    const input = document.getElementById(id);
    const errorDiv = document.getElementById(id + "Error");

    input.classList.toggle("input-error", !condition);
    input.classList.toggle("input-valid", condition);
    if (errorDiv) errorDiv.textContent = condition ? "" : errorMessage;
  }

  // Real-time validation for complaint form
  document.getElementById("fullName").addEventListener("input", () => {
    validateField(
      "fullName",
      document.getElementById("fullName").value.trim() !== "",
      "Full name is required."
    );
  });

  document.getElementById("mobile").addEventListener("input", () => {
    validateField(
      "mobile",
      /^\d{10}$/.test(document.getElementById("mobile").value.trim()),
      "Enter a valid 10-digit mobile number."
    );
  });

  document.getElementById("pin").addEventListener("input", function () {
    const pin = this.value.trim();
    validateField(
      "pin",
      /^\d{6}$/.test(pin),
      "Enter a valid 6-digit pin code."
    );
    if (pin.length === 6) fetchLocality();
  });

  document.getElementById("locality").addEventListener("change", () => {
    validateField(
      "locality",
      document.getElementById("locality").value !== "",
      "Please select a locality."
    );
  });

  // Enhanced address validation
  document.getElementById("houseNo").addEventListener("input", () => {
    validateField(
      "houseNo",
      document.getElementById("houseNo").value.trim() !== "",
      "House/Flat number is required."
    );
  });

  document.getElementById("street").addEventListener("input", () => {
    validateField(
      "street",
      document.getElementById("street").value.trim() !== "",
      "Street/Area is required."
    );
  });

  document.getElementById("stateSelect").addEventListener("change", function () {
    validateField("stateSelect", this.value !== "", "Please select a State.");
  });

  // Product validation
  document.getElementById("productType").addEventListener("input", () => {
    validateField(
      "productType",
      document.getElementById("productType").value.trim() !== "",
      "Product type is required."
    );
  });

  document.getElementById("productName").addEventListener("input", () => {
    validateField(
      "productName",
      document.getElementById("productName").value.trim() !== "",
      "Product name is required."
    );
  });

  document.getElementById("modelNo").addEventListener("input", () => {
    validateField(
      "modelNo",
      document.getElementById("modelNo").value.trim() !== "",
      "Model number is required."
    );
  });

  document.getElementById("manufacturer").addEventListener("input", () => {
    validateField(
      "manufacturer",
      document.getElementById("manufacturer").value.trim() !== "",
      "Manufacturer is required."
    );
  });

  document.getElementById("purchaseDate").addEventListener("input", function () {
    const selectedDate = new Date(this.value);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (selectedDate > today) {
      showToast("Date of Purchase cannot be in the future.", "error");
      this.value = "";
    }
    validateField(
      "purchaseDate",
      this.value !== "",
      "Purchase date is required."
    );
  });

  document.getElementById("warrantyExpiry").addEventListener("input", function () {
    validateField(
      "warrantyExpiry",
      this.value !== "",
      "Warranty expiry date is required."
    );
  });

  document.getElementById("availableDate").addEventListener("input", function () {
    const selectedDate = new Date(this.value);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (selectedDate < today) {
      showToast("Available date cannot be in the past.", "error");
      this.value = "";
    }
    validateField(
      "availableDate",
      this.value !== "",
      "Available date is required."
    );
  });

  document.getElementById("preferredTime").addEventListener("change", function () {
    validateField(
      "preferredTime",
      this.value !== "",
      "Please select a preferred time slot."
    );
  });

  // Radio button validation
  document.querySelectorAll('input[name="callType"]').forEach((radio) => {
    radio.addEventListener("change", () => {
      const callTypeError = document.getElementById("callTypeError");
      callTypeError.textContent = document.querySelector(
        'input[name="callType"]:checked'
      )
        ? ""
        : "Please select a call type.";
    });
  });

  document.querySelectorAll('input[name="priority"]').forEach((radio) => {
    radio.addEventListener("change", () => {
      const priorityError = document.getElementById("priorityError");
      priorityError.textContent = document.querySelector(
        'input[name="priority"]:checked'
      )
        ? ""
        : "Please select call priority.";
    });
  });

  // Enhanced form submission with product storage
  callForm.addEventListener("submit", async function (e) {
    e.preventDefault();
    let isValid = true;

    // Validate all customer fields
    validateField(
      "fullName",
      document.getElementById("fullName").value.trim() !== "",
      "Full name is required."
    );
    validateField(
      "mobile",
      /^\d{10}$/.test(document.getElementById("mobile").value.trim()),
      "Enter a valid 10-digit mobile number."
    );
    validateField(
      "pin",
      /^\d{6}$/.test(document.getElementById("pin").value.trim()),
      "Enter a valid 6-digit pin code."
    );
    validateField(
      "locality",
      document.getElementById("locality").value !== "",
      "Please select a locality."
    );
    validateField(
      "houseNo",
      document.getElementById("houseNo").value.trim() !== "",
      "House/Flat number is required."
    );
    validateField(
      "street",
      document.getElementById("street").value.trim() !== "",
      "Street/Area is required."
    );
    validateField(
      "stateSelect",
      document.getElementById("stateSelect").value !== "",
      "Please select a State."
    );

    // Validate all product fields
    validateField(
      "productType",
      document.getElementById("productType").value.trim() !== "",
      "Product type is required."
    );
    validateField(
      "productName",
      document.getElementById("productName").value.trim() !== "",
      "Product name is required."
    );
    validateField(
      "modelNo",
      document.getElementById("modelNo").value.trim() !== "",
      "Model number is required."
    );
    validateField(
      "serial",
      document.getElementById("serial").value.trim() !== "",
      "Serial number is required."
    );
    validateField(
      "manufacturer",
      document.getElementById("manufacturer").value.trim() !== "",
      "Manufacturer is required."
    );
    validateField(
      "purchaseDate",
      document.getElementById("purchaseDate").value !== "",
      "Purchase date is required."
    );
    validateField(
      "warrantyExpiry",
      document.getElementById("warrantyExpiry").value !== "",
      "Warranty expiry date is required."
    );
    validateField(
      "availableDate",
      document.getElementById("availableDate").value !== "",
      "Available date is required."
    );
    validateField(
      "preferredTime",
      document.getElementById("preferredTime").value !== "",
      "Please select a preferred time slot."
    );

    // Check radio buttons
    if (!document.querySelector('input[name="callType"]:checked')) {
      document.getElementById("callTypeError").textContent =
        "Please select a call type.";
      isValid = false;
    }
    if (!document.querySelector('input[name="priority"]:checked')) {
      document.getElementById("priorityError").textContent =
        "Please select call priority.";
      isValid = false;
    }

    if (!isValid) {
      showToast("Please fill all required fields correctly", "error");
      return;
    }
    const callType = document.querySelector('input[name="callType"]:checked')?.value || '';
    const priority = document.querySelector('input[name="priority"]:checked')?.value || '';

    // Get other field values
    const fullName = document.getElementById("fullName").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const houseNo = document.getElementById("houseNo").value.trim();
    const street = document.getElementById("street").value.trim();
    const landmark = document.getElementById("landmark").value.trim();
    const pin = document.getElementById("pin").value.trim();
    const locality = document.getElementById("locality").value;
    const city = document.getElementById("city").value;
    const state = document.getElementById("stateSelect").value;

    const productType = document.getElementById("productType").value.trim();
    const productName = document.getElementById("productName").value.trim();
    const modelNo = document.getElementById("modelNo").value.trim();
    const serial = document.getElementById("serial").value.trim();
    const manufacturer = document.getElementById("manufacturer").value.trim();
    const purchaseDate = document.getElementById("purchaseDate").value;
    const warrantyExpiry = document.getElementById("warrantyExpiry").value;

    const availableDate = document.getElementById("availableDate").value;
    const preferredTime = document.getElementById("preferredTime").value;
    const comments = document.getElementById("comments").value.trim();
    const registrationDate = Date.now();
    // Create object to send
    const CustomerComplaintData = {
      callType,
      fullName,
      mobile,
      houseNo,
      street,
      landmark,
      pin,
      locality,
      productType,
      city,
      state,
      availableDate,
      preferredTime,
      comments,
      priority,
      registrationDate
    };
    // Prepare product data for storage
    const productData = {
      productType,
      productName,
      modelNo,
      serial,
      manufacturer,
      purchaseDate,
      warrantyExpiry,
    };
    console.log(productData)

    // Start collecting toast messages
    const toastMessages = [];
    let finalToastType = "success";
    const submitBtn = document.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    try {
      const token = getCookie("token");
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      submitBtn.disabled = true;

      // Try to add product
      try {
        await addProductToDatabase(productData, token);
        toastMessages.push("Product saved successfully!");
      } catch (productError) {
        console.warn("Product save warning:", productError.message);
        toastMessages.push(
          productError.message.includes("already exists")
            ? "ℹ️ Product already exists"
            : "⚠️ Product not saved (continuing with complaint)"
        );
        if (!productError.message.includes("already exists")) {
          finalToastType = "warning";
        }
      }

      // Register complaint
      const response = await fetch(`${API_URL}/job/registerComplaint`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
        body: JSON.stringify(CustomerComplaintData),
      });

      const json = await response.json();

      if (!response.ok) {
        throw new Error(json.message || json.error || "Complaint registration failed");
      }

      toastMessages.push("Complaint registered successfully!");
      resetForm();

    } catch (error) {
      console.error("Submission failed:", error.message);
      toastMessages.push(`❌ Error: ${error.message}`);
      finalToastType = "error";
    } finally {
      showToast(toastMessages.join('\n'), finalToastType);
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
    }
  })

  // Reset button
  document.getElementById("resetBtn").addEventListener("click", resetForm);

  // Function to add product to database
  async function addProductToDatabase(productData, token) {
    const productUrl = `${API_URL}/product/addProduct`;

    const response = await fetch(productUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify(productData),
    });

    const json = await response.json();

    if (!response.ok) {
      throw new Error(json.message || json.error || "Failed to save product");
    }

    return json;
  }

  // Fixed function to fetch locality based on PIN code
  function fetchLocality() {
    const pin = document.getElementById("pin").value.trim();
    const localityInput = document.getElementById("locality");
    const cityInput = document.getElementById("city");
    const localityError = document.getElementById("localityError");

    if (pin.length === 6 && /^\d{6}$/.test(pin)) {
      // Show loading state
      localityInput.innerHTML = '<option value="">Loading...</option>';
      localityError.textContent = "";

      fetch(`https://api.postalpincode.in/pincode/${pin}`)
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          if (data && data.length > 0 && data[0].Status === "Success" && data[0].PostOffice) {
            localityInput.innerHTML = '<option value="">-- Select locality --</option>';

            // Set city from first post office
            if (data[0].PostOffice.length > 0) {
              cityInput.value = data[0].PostOffice[0].District || "";
            }

            // Add unique localities to avoid duplicates
            const uniqueLocalities = new Set();
            data[0].PostOffice.forEach((po) => {
              if (po.Name && po.District) {
                const localityValue = `${po.Name}, ${po.District}`;
                if (!uniqueLocalities.has(localityValue)) {
                  uniqueLocalities.add(localityValue);
                  const option = document.createElement("option");
                  option.value = localityValue;
                  option.textContent = localityValue;
                  localityInput.appendChild(option);
                }
              }
            });

            if (localityInput.children.length === 1) {
              localityInput.innerHTML = '<option value="">-- No locality found --</option>';
              localityError.textContent = "No locality found for this PIN";
              showToast("No locality found for this PIN", "error");
            } else {
              localityError.textContent = "";
            }
          } else {
            localityInput.innerHTML = '<option value="">-- No locality found --</option>';
            cityInput.value = "";
            localityError.textContent = "No locality found for this PIN";
            showToast("No locality found for this PIN", "error");
          }
        })
        .catch((error) => {
          console.error("Error fetching locality:", error);
          localityInput.innerHTML = '<option value="">-- Error fetching locality --</option>';
          cityInput.value = "";
          localityError.textContent = "Error fetching locality. Please try again.";
          showToast("Error fetching locality. Please check your internet connection.", "error");
        });
    } else {
      localityInput.innerHTML = '<option value="">-- Select locality --</option>';
      cityInput.value = "";
      localityError.textContent = "";
    }
  }

  // Enhanced reset form function
  function resetForm() {
    callForm.reset();
    document.getElementById("locality").innerHTML =
      '<option value="">-- Select locality --</option>';
    document.getElementById("city").value = "";

    document.querySelectorAll(".error-message").forEach((error) => {
      error.textContent = "";
    });

    document.querySelectorAll("input, select, textarea").forEach((input) => {
      input.classList.remove("input-error", "input-valid");
    });

    // showToast("Form reset successfully", "success");
  }
}

function initUI() {
  // Notification button
  const notificationBtn = document.querySelector(".notification-btn");
  if (notificationBtn) {
    notificationBtn.addEventListener("click", () =>
      showToast("Notifications panel would open here", "success")
    );
  }

  simulateRealTimeUpdates();
}

function initToast() {
  // Toast container will be created when needed
}

// Utility Functions
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(";").shift();
}

// function showToast(message, type = "success", duration = 3000) {
//   let container = document.querySelector(".toast-container");
//   if (!container) {
//     container = document.createElement("div");
//     container.className = "toast-container";
//     document.body.appendChild(container);
//   }

//   // Prevent duplicate toast messages
//   if (
//     Array.from(container.children).some(
//       (toast) => toast.textContent === message
//     )
//   ) {
//     return;
//   }

//   const toast = document.createElement("div");
//   toast.className = `custom-toast ${type === "error" ? "error" : "success"}`;
//   toast.textContent = message;

//   container.appendChild(toast);
//   setTimeout(() => toast.classList.add("visible"), 10);

//   setTimeout(() => {
//     toast.classList.remove("visible");
//     toast.addEventListener("transitionend", () => {
//       toast.remove();
//       if (!container.childElementCount) container.remove();
//     });
//   }, duration);
// }

function showToast(message, type = "success", duration = 3000) {
  let container = document.querySelector(".toast-container");
  if (!container) {
    container = document.createElement("div");
    container.className = "toast-container";
    document.body.appendChild(container);
  }

  // Prevent duplicate toast messages (case-insensitive comparison)
  if (Array.from(container.children).some(toast => {
    const toastMsg = toast.querySelector('.toast-message')?.textContent || toast.textContent;
    return toastMsg.trim() === message.trim();
  })) {
    return;
  }

  const toast = document.createElement("div");
  toast.className = `custom-toast ${type}`; // Now supports 'warning' type

  // Create message element (for multi-line support)
  const messageEl = document.createElement("div");
  messageEl.className = "toast-message";
  messageEl.textContent = message;
  toast.appendChild(messageEl);

  // Add close button
  const closeBtn = document.createElement("button");
  closeBtn.className = "toast-close";
  closeBtn.innerHTML = "&times;";
  closeBtn.addEventListener("click", () => {
    dismissToast(toast, container);
  });
  toast.appendChild(closeBtn);

  container.appendChild(toast);
  setTimeout(() => toast.classList.add("visible"), 10);

  // Auto-dismiss if duration > 0
  if (duration > 0) {
    setTimeout(() => dismissToast(toast, container), duration);
  }
}

// Helper function for dismissal
function dismissToast(toast, container) {
  toast.classList.remove("visible");
  toast.addEventListener("transitionend", () => {
    toast.remove();
    if (container && !container.childElementCount) {
      container.remove();
    }
  });
}

function animateStats() {
  document.querySelectorAll(".stat-value").forEach((stat) => {
    const finalValue = parseInt(stat.textContent);
    let currentValue = 0;
    const increment = finalValue / 20;

    const timer = setInterval(() => {
      currentValue += increment;
      if (currentValue >= finalValue) {
        stat.textContent = finalValue;
        clearInterval(timer);
      } else {
        stat.textContent = Math.floor(currentValue);
      }
    }, 50);
  });
}

function simulateRealTimeUpdates() {
  const activities = [
    "New service request received",
    "Job status updated",
    "Customer complaint registered",
    "Technician assigned",
    "Product added to database",
  ];

  setInterval(() => {
    const randomActivity =
      activities[Math.floor(Math.random() * activities.length)];
    addRecentActivity(randomActivity);
  }, 30000);
}

function addRecentActivity(activity) {
  const activityList = document.querySelector(".activity-list");
  if (!activityList) return;

  const newActivity = document.createElement("div");
  newActivity.className = "activity-item";
  newActivity.innerHTML = `
        <div class="activity-dot blue"></div>
        <div class="activity-content">
            <p class="activity-title">${activity}</p>
            <p class="activity-subtitle">System notification</p>
        </div>
        <span class="activity-time">Just now</span>
    `;

  activityList.insertBefore(newActivity, activityList.firstChild);
  if (activityList.children.length > 5) {
    activityList.removeChild(activityList.lastChild);
  }
}

// Public API
window.DashboardApp = {
  showSection: function (sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
      document
        .querySelectorAll(".section")
        .forEach((s) => s.classList.remove("active"));
      section.classList.add("active");

      document.querySelectorAll(".nav-item").forEach((item) => {
        item.classList.toggle("active", item.dataset.section === sectionId);
      });
    }
  },
  showToast,
  resetForm: function () {
    const callForm = document.getElementById("callForm");
    if (callForm) {
      callForm.reset();
      document.getElementById("locality").innerHTML =
        '<option value="">-- Select locality --</option>';
      document.getElementById("city").value = "";

      document
        .querySelectorAll(".error-message")
        .forEach((el) => (el.textContent = ""));
      document.querySelectorAll("input, select, textarea").forEach((el) => {
        el.classList.remove("input-error", "input-valid");
      });
    }
  },
};

</script>
</html>